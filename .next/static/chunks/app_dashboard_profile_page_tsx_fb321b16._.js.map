{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///E:/WebProjects/smallOffer/app/dashboard/profile/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport Image from \"next/image\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nimport { Form } from \"@/components/ui/form\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { SelectInput } from \"@/components/shared/SelectInput\";\r\nimport { TextareaInput } from \"@/components/shared/TextareaInput\";\r\n\r\nimport { cities, schema } from \"./formSchema\";\r\nimport { useUserInfo, useSetUserInfo } from \"@/hooks/dashboardMutation\";\r\n\r\ntype FormData = {\r\n  firstName: string;\r\n  lastName: string;\r\n  username: string;\r\n  email: string;\r\n  phoneCode: string;\r\n  phoneNumber: string;\r\n  city: string;\r\n  hood: string;\r\n  detailed_location: string;\r\n  profile_image: File | string;\r\n};\r\n\r\nconst ProfileForm = () => {\r\n  const [preview, setPreview] = useState<string | null>(null);\r\n  const { data, isLoading } = useUserInfo();\r\n  const setUserInfo = useSetUserInfo();\r\n  const [selectedCity, setSelectedCity] = useState<string>(\"\");\r\n\r\n  const form = useForm<FormData>({\r\n    resolver: zodResolver(schema),\r\n    defaultValues: {\r\n      firstName: \"\",\r\n      lastName: \"\",\r\n      username: \"\",\r\n      email: \"\",\r\n      phoneCode: \"963\",\r\n      phoneNumber: \"\",\r\n      city: \"\",\r\n      hood: \"\",\r\n      detailed_location: \"\",\r\n      profile_image: \"\",\r\n    },\r\n  });\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    setValue,\r\n    watch,\r\n    reset,\r\n    formState: { errors },\r\n  } = form;\r\n\r\n  const coverImage = watch(\"profile_image\");\r\n\r\n  useEffect(() => {\r\n    if (!isLoading && data) {\r\n      const phone = data.phone || \"\";\r\n      const code = phone.slice(0, 3) || \"963\";\r\n      const localNumber = phone.slice(3) || \"\";\r\n\r\n      const cityFromApi = cities.find(\r\n        (city) => city.value === data.city\r\n      )?.value;\r\n\r\n      setSelectedCity(cityFromApi || \"\");\r\n\r\n      reset({\r\n        firstName: data.first_name || \"\",\r\n        lastName: data.last_name || \"\",\r\n        username: data.username || \"\",\r\n        email: data.email || \"\",\r\n        phoneCode: code,\r\n        phoneNumber: localNumber,\r\n        city: data.city || cityFromApi,\r\n        hood: data.hood || \"\",\r\n        detailed_location: data.detailed_location || \"\",\r\n        profile_image: data.profile_image || \"\",\r\n      });\r\n    }\r\n  }, [isLoading, data, reset]);\r\n\r\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setPreview(URL.createObjectURL(file));\r\n      setValue(\"profile_image\", file, {\r\n        shouldValidate: true,\r\n        shouldDirty: true,\r\n      });\r\n    }\r\n  };\r\n\r\n  const onSubmit = (values: FormData) => {\r\n    const formData = new FormData();\r\n\r\n    formData.append(\"first_name\", values.firstName);\r\n    formData.append(\"last_name\", values.lastName);\r\n    formData.append(\"username\", values.username);\r\n    formData.append(\"email\", values.email);\r\n    formData.append(\"phone\", values.phoneCode + values.phoneNumber);\r\n    formData.append(\"city\", values.city);\r\n    formData.append(\"hood\", values.hood);\r\n    formData.append(\"detailed_location\", values.detailed_location);\r\n\r\n    if (values.profile_image instanceof File) {\r\n      formData.append(\"profile_image\", values.profile_image);\r\n    }\r\n\r\n    setUserInfo.mutate(formData);\r\n  };\r\n\r\n  return (\r\n    <Form {...form}>\r\n      <form\r\n        onSubmit={handleSubmit(onSubmit)}\r\n        className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\r\n      >\r\n        {/* صورة المستخدم */}\r\n        <div className=\"col-span-1 md:col-span-2\">\r\n          <label htmlFor=\"profile_image\">الصورة الشخصية</label>\r\n          <div className=\"w-32 h-32 border rounded-full overflow-hidden mb-2\">\r\n            {preview ? (\r\n              <Image\r\n                src={preview}\r\n                alt=\"preview\"\r\n                width={128}\r\n                height={128}\r\n                className=\"object-cover w-full h-full\"\r\n              />\r\n            ) : typeof coverImage === \"string\" && coverImage !== \"\" ? (\r\n              <Image\r\n                src={coverImage}\r\n                alt=\"current\"\r\n                width={128}\r\n                height={128}\r\n                className=\"object-cover w-full h-full\"\r\n              />\r\n            ) : (\r\n              <div className=\"flex items-center justify-center w-full h-full text-4xl text-cgreen\">\r\n                +\r\n              </div>\r\n            )}\r\n          </div>\r\n          <Input\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            id=\"profile_image\"\r\n            onChange={handleImageChange}\r\n          />\r\n        </div>\r\n\r\n        {/* الاسم الأول */}\r\n        <Input\r\n          label=\"الاسم الأول\"\r\n          {...register(\"firstName\")}\r\n          error={errors.firstName?.message}\r\n        />\r\n\r\n        {/* الاسم الأخير */}\r\n        <Input\r\n          label=\"الاسم الأخير\"\r\n          {...register(\"lastName\")}\r\n          error={errors.lastName?.message}\r\n        />\r\n\r\n        {/* اسم المستخدم */}\r\n        <Input\r\n          label=\"اسم المستخدم\"\r\n          {...register(\"username\")}\r\n          error={errors.username?.message}\r\n        />\r\n\r\n        {/* البريد الإلكتروني */}\r\n        <Input\r\n          label=\"البريد الإلكتروني\"\r\n          {...register(\"email\")}\r\n          error={errors.email?.message}\r\n        />\r\n\r\n        {/* رقم الهاتف */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <Input\r\n            label=\"رمز الدولة\"\r\n            className=\"w-20\"\r\n            {...register(\"phoneCode\")}\r\n            error={errors.phoneCode?.message}\r\n          />\r\n          <Input\r\n            label=\"رقم الهاتف\"\r\n            {...register(\"phoneNumber\")}\r\n            error={errors.phoneNumber?.message}\r\n          />\r\n        </div>\r\n\r\n        {/* المحافظة */}\r\n        <SelectInput\r\n          label=\"المحافظة\"\r\n          options={cities}\r\n          value={selectedCity}\r\n          onChange={(value) => {\r\n            setValue(\"city\", value, {\r\n              shouldDirty: true,\r\n              shouldValidate: true,\r\n            });\r\n            setSelectedCity(value);\r\n          }}\r\n          error={errors.city?.message}\r\n        />\r\n\r\n        {/* المنطقة */}\r\n        <Input\r\n          label=\"المنطقة\"\r\n          {...register(\"hood\")}\r\n          error={errors.hood?.message}\r\n        />\r\n\r\n        {/* تفاصيل العنوان */}\r\n        <TextareaInput\r\n          label=\"تفاصيل إضافية\"\r\n          {...register(\"detailed_location\")}\r\n          error={errors.detailed_location?.message}\r\n        />\r\n\r\n        {/* زر الحفظ */}\r\n        <div className=\"col-span-1 md:col-span-2 mt-4\">\r\n          <Button type=\"submit\" className=\"w-full\">\r\n            حفظ التعديلات\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </Form>\r\n  );\r\n};\r\n\r\nexport default ProfileForm;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}